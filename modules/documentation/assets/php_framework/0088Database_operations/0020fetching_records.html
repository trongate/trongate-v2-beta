<h1>abcFetching Records</h1>

<div class="alert alert-success">
    <p>The examples on this page demonstrate querying the <strong>default database from a controller</strong>.</p>
    <p>In real-world applications, you'll typically handle database queries in model files. Details on using models with databases are covered at the end of this chapter.</p>
</div>

<h2>Understanding Table Names</h2>

<p>Most methods in Trongate's DB class include an optional <code>$target_table</code> parameter.</p>

<p>When you <strong>don't</strong> pass a table name, Trongate automatically uses the first URL segment as the table name.</p>

<p>For example, if your URL is <code>https://yoursite.com/products/display</code>, the table name defaults to <code>products</code>.</p>

<div class="alert alert-warning">
    <p><strong>Be explicit when needed.</strong> If your URL doesn't match your table name, always pass the table name as an argument.</p>
</div>

<hr>

<h2>get()</h2>

<p>Fetches multiple records from a table.</p>

[code=php]
public function get(
    ?string $order_by = null,
    ?string $target_tbl = null,
    ?int $limit = null,
    int $offset = 0
): array
[/code]

<p class="sm"><strong>NOTE:</strong> This method returns an array of objects, where each object represents a row from the database table.</p>

<h3>Parameters</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>order_by</td>
            <td>string|null</td>
            <td>Column to order results by</td>
            <td>'id'</td>
        </tr>
        <tr>
            <td>target_tbl</td>
            <td>string|null</td>
            <td>Table name to query</td>
            <td>First URL segment</td>
        </tr>
        <tr>
            <td>limit</td>
            <td>int|null</td>
            <td>Maximum number of results</td>
            <td>null</td>
        </tr>
        <tr>
            <td>offset</td>
            <td>int</td>
            <td>Number of rows to skip</td>
            <td>0</td>
        </tr>
    </tbody>
</table>

<h3>Example #1: Fetch All Records</h3>
<p>Get all records, ordered by ID (default):</p>
[code=php]
$products = $this->db->get('id', 'products');
[/code]

<h3>Example #2: Custom Ordering</h3>
<p>Get all orders, sorted by date descending:</p>
[code=php]
$orders = $this->db->get('order_date desc', 'orders');
[/code]

<h3>Example #3: With Limit and Offset</h3>
<p>Get 10 users, skip the first 5:</p>
[code=php]
$users = $this->db->get('username', 'users', 10, 5);
[/code]

<h3>Example #4: Auto-Detect Table Name</h3>
<p>If your URL is <code>yoursite.com/members/display</code>, omit the table name:</p>
[code=php]
$members = $this->db->get();
[/code]

<hr>

<h2>get_where()</h2>

<p>Fetches a single record by its ID.</p>

[code=php]
public function get_where(
    int $id,
    ?string $target_table = null
): object|false
[/code]

<p class="sm"><strong>NOTE:</strong> This method returns an object representing the database row, or <code>false</code> if no record is found.</p>

<h3>Parameters</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>id</td>
            <td>int</td>
            <td>The ID of the record to fetch</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>target_table</td>
            <td>string|null</td>
            <td>Table name to query</td>
            <td>First URL segment</td>
        </tr>
    </tbody>
</table>

<h3>Example #1: Fetch User by ID</h3>
[code=php]
$user = $this->db->get_where(42, 'users');

if ($user) {
    echo $user-&gt;username;
} else {
    echo 'User not found';
}
[/code]

<h3>Example #2: Auto-Detect Table</h3>
<p>If URL is <code>yoursite.com/products/edit/88</code>:</p>
[code=php]
$product = $this->db->get_where(88);
[/code]

<hr>

<h2>get_one_where()</h2>

<p>Fetches a single record based on a column value.</p>

[code=php]
public function get_one_where(
    string $column,
    $value,
    ?string $target_table = null
): object|false
[/code]

<p class="sm"><strong>NOTE:</strong> This method returns an object representing the database row, or <code>false</code> if no record is found.</p>

<h3>Parameters</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>column</td>
            <td>string</td>
            <td>Column name to filter by</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>value</td>
            <td>mixed</td>
            <td>Value to match</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>target_table</td>
            <td>string|null</td>
            <td>Table name to query</td>
            <td>First URL segment</td>
        </tr>
    </tbody>
</table>

<h3>Example #1: Find User by Email</h3>
[code=php]
$user = $this->db->get_one_where('email', 'john@example.com', 'users');

if ($user) {
    echo 'Welcome back, ' . $user-&gt;first_name;
}
[/code]

<h3>Example #2: Find Product by SKU</h3>
[code=php]
$product = $this->db->get_one_where('sku', 'WIDGET-001', 'products');
[/code]

<hr>

<h2>get_many_where()</h2>

<p>Fetches multiple records based on a column value.</p>

[code=php]
public function get_many_where(
    string $column,
    $value,
    ?string $target_table = null
): array
[/code]

<p class="sm"><strong>NOTE:</strong> This method returns an array of objects, where each object represents a row from the database table. An empty array is returned if no records are found.</p>

<h3>Parameters</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>column</td>
            <td>string</td>
            <td>Column name to filter by</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>value</td>
            <td>mixed</td>
            <td>Value to match</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>target_table</td>
            <td>string|null</td>
            <td>Table name to query</td>
            <td>First URL segment</td>
        </tr>
    </tbody>
</table>

<h3>Example #1: Get Active Users</h3>
[code=php]
$active_users = $this->db->get_many_where('status', 'active', 'users');

foreach ($active_users as $user) {
    echo $user-&gt;username . '&lt;br&gt;';
}
[/code]

<h3>Example #2: Get Orders by Customer</h3>
[code=php]
$customer_id = 42;
$orders = $this->db->get_many_where('customer_id', $customer_id, 'orders');
[/code]

<hr>

<h2>get_where_custom()</h2>

<p>The power tool. Fetches records with custom comparison operators, ordering, limits, and offsets.</p>

[code=php]
public function get_where_custom(
    string $column,
    $value,
    string $operator = '=',
    string $order_by = 'id',
    ?string $target_table = null,
    ?int $limit = null,
    ?int $offset = null
): array
[/code]

<p class="sm"><strong>NOTE:</strong> This method returns an array of objects, where each object represents a row from the database table. An empty array is returned if no records are found.</p>

<h3>Parameters</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>column</td>
            <td>string</td>
            <td>Column name to filter by</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>value</td>
            <td>mixed</td>
            <td>Value to match</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>operator</td>
            <td>string</td>
            <td>Comparison operator</td>
            <td>'='</td>
        </tr>
        <tr>
            <td>order_by</td>
            <td>string</td>
            <td>Column to order by</td>
            <td>'id'</td>
        </tr>
        <tr>
            <td>target_table</td>
            <td>string|null</td>
            <td>Table name to query</td>
            <td>First URL segment</td>
        </tr>
        <tr>
            <td>limit</td>
            <td>int|null</td>
            <td>Maximum results</td>
            <td>null</td>
        </tr>
        <tr>
            <td>offset</td>
            <td>int|null</td>
            <td>Rows to skip</td>
            <td>null</td>
        </tr>
    </tbody>
</table>

<h3>Valid Operators</h3>
<p><code>=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>&lt;&gt;</code>, <code>!=</code>, <code>LIKE</code>, <code>NOT LIKE</code></p>

<h3>Example #1: Products Above a Price</h3>
[code=php]
$expensive = $this->db->get_where_custom('price', 100, '&gt;', 'price desc', 'products');
[/code]

<h3>Example #2: Incomplete Tasks</h3>
[code=php]
$tasks = $this->db->get_where_custom('status', 'completed', '!=', 'created_at', 'tasks');
[/code]

<h3>Example #3: Search Titles (LIKE)</h3>
[code=php]
$articles = $this->db->get_where_custom('title', 'PHP', 'LIKE', 'published_at desc', 'articles');
[/code]

<h3>Example #4: With Limit and Offset</h3>
[code=php]
$orders = $this->db->get_where_custom('status', 'pending', '=', 'order_date desc', 'orders', 20, 0);
[/code]

<hr>

<h2>get_where_in()</h2>

<p>Fetches records where a column's value matches any value in an array. Perfect for bulk lookups.</p>

[code=php]
public function get_where_in(
    string $column,
    array $values,
    ?string $target_table = null,
    string $return_type = 'object'
): array
[/code]

<p class="sm"><strong>NOTE:</strong> This method returns an array of objects (or arrays, if <code>$return_type</code> is set to 'array'), where each element represents a row from the database table. An empty array is returned if no records are found.</p>

<h3>Parameters</h3>
<table class="table">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Description</th>
            <th>Default</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>column</td>
            <td>string</td>
            <td>Column name to filter by</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>values</td>
            <td>array</td>
            <td>Array of values to match</td>
            <td>N/A</td>
        </tr>
        <tr>
            <td>target_table</td>
            <td>string|null</td>
            <td>Table name to query</td>
            <td>First URL segment</td>
        </tr>
        <tr>
            <td>return_type</td>
            <td>string</td>
            <td>'object' or 'array'</td>
            <td>'object'</td>
        </tr>
    </tbody>
</table>

<h3>Example #1: Get Specific Users</h3>
[code=php]
$user_ids = [5, 12, 47, 99];
$users = $this->db->get_where_in('id', $user_ids, 'users');

foreach ($users as $user) {
    echo $user-&gt;username . '&lt;br&gt;';
}
[/code]

<h3>Example #2: Return as Arrays</h3>
[code=php]
$product_ids = [10, 20, 30];
$products = $this->db->get_where_in('id', $product_ids, 'products', 'array');
[/code]

<h3>Example #3: Filter by Category</h3>
[code=php]
$categories = ['electronics', 'computers', 'phones'];
$items = $this->db->get_where_in('category', $categories, 'products');
[/code]

<div class="alert alert-info">
    <p><strong>Pro tip:</strong> All these methods use prepared statements internally. Your data is safe from SQL injection.</p>
</div>

<p class="text-center mt-3"><strong>Fetch data. Build features. Ship code.</strong></p>